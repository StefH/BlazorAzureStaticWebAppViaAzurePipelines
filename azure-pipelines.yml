trigger:
- main

pool:
  vmImage: 'ubuntu-18.04'

resources:
  containers:
  - container: staticappsclient
    image: mcr.microsoft.com/appsvc/staticappsclient:stable
    options: --userns host

steps:
- script: echo Hello, world!
  displayName: 'Run a one-line script'

- task: CmdLine@2
  target: host
  inputs:
    script: 'ls -al'

- task: CmdLine@2
  condition: false
  displayName: 'Install dotnet-sdk-3.1a'
  target: staticappsclient
  inputs:
    script: |
      apt-get install sudo
      wget -O - https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.asc.gpg
      mv microsoft.asc.gpg /etc/apt/trusted.gpg.d/
      wget https://packages.microsoft.com/config/debian/9/prod.list
      mv prod.list /etc/apt/sources.list.d/microsoft-prod.list
      chown root:root /etc/apt/trusted.gpg.d/microsoft.asc.gpg
      chown root:root /etc/apt/sources.list.d/microsoft-prod.list
      apt-get install -y apt-transport-https
      apt-get update
      apt-get install -y dotnet-sdk-3.1

- task: UseDotNet@2
  condition: true
  displayName: 'Use .NET Core sdk'
  target: staticappsclient
  inputs:
    packageType: sdk
    version: 3.1.x

- task: UseDotNet@2
  condition: true
  displayName: 'Use .NET Core runtime'
  target: staticappsclient
  inputs:
    packageType: runtime
    version: 3.1.10
- task: Bash@3
  condition: true
  displayName: 'Install dotnet-sdk-3.1.10 sudo???'
  target: staticappsclient
  inputs:
    targetType: inline
    script: |
      sudo apt-get install -y sudo
      wget -O - https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.asc.gpg
      sudo mv microsoft.asc.gpg /etc/apt/trusted.gpg.d/
      wget https://packages.microsoft.com/config/debian/9/prod.list
      sudo mv prod.list /etc/apt/sources.list.d/microsoft-prod.list
      sudo chown root:root /etc/apt/trusted.gpg.d/microsoft.asc.gpg
      sudo chown root:root /etc/apt/sources.list.d/microsoft-prod.list
      sudo apt-get install -y apt-transport-https
      sudo apt-get update
      sudo apt-get install -y dotnet-sdk-3.1.10

- task: Bash@3
  target: staticappsclient
  inputs:
    targetType: inline
    script: |
      cd /bin/staticsites/
      ./StaticSitesClient upload --verbose True --apiToken $(API_TOKEN) --workdir $(Build.SourcesDirectory) --api Api --app Client --outputLocation wwwroot